<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, { renderer: 'canvas' });

    var option = {
      title: { text: 'Real-Time Network Traffic (Simulated)', left: 'center' },
      tooltip: { trigger: 'axis' },
      
      // Use 'category' for timestamps so they appear as labels
      xAxis: {
        type: 'category',
        boundaryGap: false, // Makes the line start exactly on the edge
        data: [] 
      },
      yAxis: {
        type: 'value',
        scale: true // Focuses the graph on the data range (doesn't force 0 at bottom)
      },
      series: [
        {
          name: 'Traffic',
          type: 'line',
          data: [],
          smooth: true,
          showSymbol: false, // Hides the dots on the line for a cleaner look
          areaStyle: {}
        }
      ],
      animationDuration: 500 // Makes the update transition faster (0.5s)
    };

    myChart.setOption(option);

    function fetchData() {
      fetch('./data.json?t=' + new Date().getTime())
        .then(response => response.json())
        .then(data => {
          
          // The Python script gives us a list of objects: [{time: "...", value: ...}]
          // We need to split this into two separate arrays for ECharts
          
          const timestamps = data.map(item => item.time);
          const values = data.map(item => item.value);

          myChart.setOption({
            xAxis: {
              data: timestamps
            },
            series: [{
              data: values
            }]
          });
        })
        .catch(error => console.error('Waiting for data...'));
    }

    // Fetch every 1000ms (1 second) to match the Python script
    setInterval(fetchData, 1000);
    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>
